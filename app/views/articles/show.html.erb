<div class ="mb-5 pb-5">
  <div class="article-info">
      <h2><%= @article.title %></h2>
  </div>

  <img class="article-image" src="<%= @article.image_url %>" alt="<%@article.title%>">

  <div class="article-header">

    <div class="app-button" data-controller="favoritor"  style="width:50px" data-action="click->favoritor#bookmark" data-favoritor-target="bookmark" data-favoritor-url-value="<%=toggle_favorite_article_path(@article)%>">
      <% if current_user.favorited?(@article) %>
        <i class="fa-solid fa-bookmark"></i>
      <% else %>
        <i class="fa-regular fa-bookmark"></i>
      <% end %>
    </div>
     <!-- Share Button -->
      <div data-controller="share-button" class="share-button-container">
          <button data-action="click->share-button#toggle" class="app-button share-button"><i class="fa-duotone fa-solid fa-share-nodes"></i></button>
          <div data-share-button-target="options" class="share-options">
            <a href="https://www.facebook.com/sharer/sharer.php?u=<%= request.original_url %>&quote=<%= @article.title %>" target="_blank" class="share-icon"><i class="fab fa-facebook-f"></i></a>
            <a href="https://twitter.com/intent/tweet?url=<%= request.original_url %>&text=<%= @article.title %>" target="_blank" class="share-icon"><i class="fab fa-twitter"></i></a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=<%= request.original_url %>&title=<%= @article.title %>" target="_blank" class="share-icon"><i class="fab fa-linkedin-in"></i></a>
            <a href="https://api.whatsapp.com/send?text=<%= @article.title %> <%= request.original_url %>" target="_blank" class="share-icon"><i class="fab fa-whatsapp"></i></a>
            <a href="mailto:?subject=<%= @article.title %>&body=<%= request.original_url %>" target="_blank" class="share-icon"><i class="fas fa-envelope"></i></a>
          </div>
      </div>
  </div>


    <div class="article-info">
      <p class="mb-0">Media : <%= @article.source_name %></p>
      <p class="mb-0">Category : <%= @article.category.split("/")[1] %></p>
      <p><%= ((Time.now - Time.parse(@article.pub_date.to_s)) / 3600).round %> hours ago</p>
      <div class ="fake-news-bar" style="width:<%= (@article.probability.round(2) * 100).to_i %>%">
        <div class ="fake-news-bg-bar">
        </div>
      </div>
      <div id="meter">
      <div>
        <% if @article.fake_news_validation == true %>
            <p style="margin-bottom:0;">This article spreads <span style="color:#c21615;">misinformation</span></p>
          <% else %>
            <p style="margin-bottom:0;">This article is <span style="color:#029702;">verified</span></p>
          <% end %>
          <p>We are <%= (@article.probability.round(2) * 100).to_i %>% confident on this assessment</p>
      </div>
      </div>
    </div>
    <div class="content">
    </div>
  <div class="article-info pt-3">
    <p><%= @article.content %></p>
  </div>
  <div class="article-info">
    <a href="<%= @article.article_url %>" target="_blank"> Visit the original article</a>
  </div>
    <div class="suggested_articles">
      <%= link_to "See all articles", articles_path, class: "glow" %>
      </div>
      <div class="grid">
        <h2 class="d-flex justify-content-center">Suggested articles: </h2>
        <% @articles.each do |article| %>
            <div class="listed-suggested-article">
                <% prob = article.probability.round(2) * 100 %>
                <% prob_value = prob.to_i  %>
                <% prob_value = prob_value * -1 if prob_value < 0 %>
              <div class="icon">
                <% if article.fake_news_validation == true %>
                  <% if prob_value >= 80 && prob_value <= 100 %>
                    <span>ðŸ”´</span>
                    <% elsif prob_value >= 60 && prob_value < 80 %>
                    <span>ðŸŸ </span>
                    <% else %>
                    <span>ðŸŸ¡</span>
                  <% end %>
                <% else %>
                  <span>ðŸŸ¢</span>
                <% end %>
              </div>
              <div >
                <% if article.fake_news_validation == true %>
                    <% fake_value = "This article spreads misinformation" %>
                  <% else %>
                    <% fake_value = "This article is verified" %>
                  <% end %>
                    <h3 style="width:240px"><%= link_to article.title.truncate(100), article_path(article)%></h3>
                    <p><%= fake_value %> | We are <%= prob_value %>% confident on this assessment</p>
              </div>
            </div>
          <% end %>
      </div>
      <% unless @comments.empty? %>
        <div class="comments">
          <h2>User comments :</h2>
          <% @comments.reverse_each do |comment| %>
            <div class="py-2 border-top comment">
              <% if comment.user_id == current_user.id %>
                <%= link_to ("<i class='fa-solid fa-xmark fa-xl'></i>").html_safe, article_comment_path(comment.id), data: {turbo_method: :delete, turbo_confirm: "Are you sure to delete your comment ?"} %>
              <% end %>
              <h4 class="mb-0"><%= User.find(comment.user_id).username %></h4>
              <p class="t-small"><%= comment.created_at.strftime("%Hh%M - %d/%m/%Y") %></p>
              <p>"<%= comment.content %>"</p>
            </div>
          <% end %>
        </div>
      <% end %>
      <div class="comments">
        <h2 class>Add my comment</h3>
        <%= simple_form_for [ @article, @new_comment ] do |f| %>
          <%= f.text_area :content %>
          <%= f.submit class: "glow mt-2" %>
        <% end %>
      </div>
    </div>
